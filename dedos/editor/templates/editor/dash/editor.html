{% extends "editor/dash/base-editor.html" %}
{% load static %}
<!-- Cargamos los archivos estaticos -->
{% load i18n %}
<!-- Cargamos el módulo de Internacionalización -->
{% block content %}

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
	aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header" style="text-align: center;">
				<h5 class="modal-title" id="exampleModalLabel">Datos del proyecto</h5>
				<!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button> -->
			</div>
			<div class="modal-body">


				<form action="/action_page.html">
					<fieldset>
						<label for="nombre">Nombre:</label>
						<input type="text" name="nombre" id="nombre"><br><br>
						
						<label for="descripcion">Descripción:</label>
						<input type="text" name="descripcion" id="descripcion"><br><br>

						<label for="curso">Nivel educativo:</label> 
						<select name="curso" id="curso">
							<option value="Infantil">Infantil</option>
							<option value="Primaria">Primaria</option>
							<option value="Necsidades especiales">Necsidades especiales</option>
						</select><br><br>

						<label for="asignatura">Asignatura:</label>
						<select name="asignatura" id="asignatura">
							<option value="Matemáticas">Matemáticas</option>
							<option value="Ciencias Naturales">Ciencias Naturales</option>
							<option value="Lengua Castellana y Literatura">Lengua Castellana y Literatura</option>
							<option value="Inglés">Inglés</option>
							<option value="Conocimiento corporal y construcción de la propia identidad">Conocimiento corporal y construcción de la propia identidad</option>
							<option value="Conocimiento y participación en el medio físico y social">Conocimiento y participación en el medio físico y social</option>
							<option value="Comunicación y lenguaje">Comunicación y lenguaje</option>
						</select><br><br>
						
						
						
						
						
					
						


						
						<label for="etiquetas">Etiquetas</label>
						<input type="text" name="etiquetas" id="etiquetas"><br><br>
						<label for="privacidad">Privacidad:</label>
						<input type="radio" name="privacidad" value="0" id="publico" checked>Público
						<label for="privacidad"></label>
						<input type="radio" name="privacidad" value="1" id="privado">Privado<br><br>

					</fieldset>
				</form>





			</div>
			<div class="modal-footer" style="text-align: center;">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
				<button id="submit" type="button" class="btn btn-primary">Guardar</button>
			</div>
		</div>
	</div>
</div>
<div class=" align-content-center" style="background-color: lightgrey">
	<!--<div class="col-md-12">Proyecto | Actividad | Modo | Idioma</div>-->
</div>
<div id="editzone">
	<section class="sticky-div fondo">
		<div class="row" id="toolbar" style="margin-top: 10px;">
			<div class="col-md-2"></div>
			<div class="col-md-1 tool " id="tool-1-icon draggable tool"
				title="Arrástreme al área de edición para crear una Zona" type="area">
				<i id="imagenArea" class="fa-solid fa-square fa-2x"></i>
			</div>

			<!-- Buenos ´area-accept-->
			<div id="TextoBueno" class="col-md-1 tool   ocultar" id="tool-2-icon draggable tool" type="card">
				<i id="imagenTexto" class="fa-solid fa-pen fa-2xl"></i>
			</div>
			<div id="FotoBueno" class="col-md-1 tool   ocultar" id="tool-3-icon draggable tool" type="picture">
				<i id="imagenFoto" class="fa-solid fa-image fa-2xl "></i>
			</div>
			<div id="SeleccionBueno" class="col-md-1 tool  ocultar" id="tool-4-icon draggable tool" type="objetive"><i
					id="imagenSeleccion" class="fa-solid fa-circle-dot fa-2xl"></i>
			</div>
			<div id="EmparejarBueno" class="col-md-1 tool  ocultar" id="tool-5-icon draggable tool" type="pairing"><i
					id="imagenEmparejar" class="fa-solid fa-arrows-split-up-and-left fa-2xl"></i>
			</div>
			<div id="CaminoBueno" class="col-md-1 tool area-accept ocultar" id="tool-6-icon draggable tool" type="path">
				<i id="imagenCamino" class="fa-solid fa-location-dot fa-2xl"></i>
			</div>
			<div id="MatesBueno" class="col-md-1 tool ocultar" id="tool-7-icon draggable tool" type="math">
				<i id="imagenMates" class="fa-solid fa-calculator fa-2xl"></i>
			</div>
			<div id="TemporizadorBueno" class="col-md-1 tool  area-accept ocultar" id="tool-8-icon draggable tool"
				type="time"><i id="imagenTemporizador" class="fa-solid fa-stopwatch fa-2xl"></i></div>

			<!-- Temporales-->

			<div id="TextoTemp" class="col-md-1" id="tool-2-icon draggable tool" type="card"><i
					class="fa-solid fa-pen fa-2xl"></i>
			</div>
			<div id="FotoTemp" class="col-md-1" id="tool-3-icon draggable tool" type="picture">
				<i class="fa-solid fa-image fa-2xl"></i>
			</div>
			<div id="SeleccionTemp" class="col-md-1" id="tool-4-icon draggable tool" type="objetive"><i
					class="fa-solid fa-circle-dot fa-2xl"></i>
			</div>
			<div id="EmparejarTemp" class="col-md-1" id="tool-5-icon draggable tool" type="pairing"><i
					class="fa-solid fa-arrows-split-up-and-left fa-2xl"></i>
			</div>
			<div id="CaminoTemp" class="col-md-1" id="tool-6-icon draggable tool" type="path"><i
					class="fa-solid fa-location-dot fa-2xl"></i>
			</div>
			<div id="MatesTemp" class="col-md-1" id="tool-7-icon draggable tool" type="math"><i
					class="fa-solid fa-calculator fa-2xl"></i>
			</div>
			<div id="TemporizadorTemp" class="col-md-1" id="tool-8-icon draggable tool" type="time"><i
					class="fa-solid fa-stopwatch fa-2xl"></i></div>
			<br>

		</div>
		<hr>
	</section>

	<input type="hidden" id="myVar" name="variable" value="{{ data }}">

	<div id="listaCanvas">
		<div id="editor-canvas_1" class="editor-canvas dropzone" style="border:2px;width:100%; height:100%">
		</div>


		


	
	</div>
	<div id="papelera" class="eliminar" class="col-md-1"><i class="fas fa-trash-alt fa-2x"
			style="margin-top: 22px ;"></i></div>

	{% csrf_token %} 

	

	<script type="text/javascript">

		Dropzone.autoDiscover = false;
		num_config_card = 0;
		num_area = 0;
		num_card = 0;
		num_picture = 0;
		num_objetive = 0;
		num_pairing = 0;
		num_path = 0;
		num_math = 0;
		num_time = 0;
		numero_areas_activas = 0;
		num_areas_creadas = 0;
		num_edior_dfdf = 0;
		num_editor_canvas = 1;
		itemTemporizador = null
		dropzoneIDCrear = null
		lastItem = null
		posLeft = 0
		posRight = 0

		num_pathid = 1
		mouseX = 500
		mouseY = 500
		lastPadreObjetive = null
		activity = "activity_1"
		previousCanvas = "#editor-canvas_1"
		canvas = "#editor-canvas_1"
		isarea = true
		pointerElementID = ""
		listPath = [] // Lista de todos los caminos y elementos
		lastCamino = null // ultimo path creado
		listElementoCaminosClonados = []
		numCaminos = 1
		const position = {
			x: 0,
			y: 0
		}

		borrar = true;
		fix = false;
		var uploadAreaID = ""
		var original = document.getElementById("activity_1")

		const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

		isPicture = false
			isCard = false
			padrePicture = null
			padreCard = null

		//Borrar 
		or = null
		$(document).ready(function () {
			$("#groupMenu").collapse("toggle");
			$("#editor").addClass("active");

			console.log("docuemnt ready")

			

			// directory path
			
			var zip = new JSZip();	
			// create a file
			zip.file("hello.txt", "Hello");
// oops, cat on keyboard. Fixing !
				zip.file("hello2.txt", "Hello World\n");
				zip.file("nested/hello.txt", "Hello World\n");

// create a file and a folder
				


zip.generateAsync({type : "blob"}).then(function(content){

	

//	console.log("Content es", content)
 //	saveAs(content, "prueba.zip", "C://")

  });



			var theDiv = document.getElementById(canvas.replace("#", ""));
			
			theDiv.appendChild(document.createElement("br"));
			theDiv.appendChild(document.createElement("br"));
			var tag = document.createElement("h1");
			tag.id = "MensajeInicial_" + canvas.replace("#","")
			tag.classList.add("center");
			var text = document.createTextNode("Este es el área de edición:");
			tag.appendChild(text);
			theDiv.appendChild(tag);
			theDiv.appendChild(document.createElement("br"));

			var tag2 = document.createElement("h1");
			tag2.classList.add("center");
			var text2 = document.createTextNode("Arrastra sobre el área los iconos de la barra de");
			tag2.appendChild(text2);
			theDiv.appendChild(tag2);

			var tag3 = document.createElement("h1");
			tag3.classList.add("center");
			var text3 = document.createTextNode("herramientas para crear una actividad");
			tag3.appendChild(text3);
			theDiv.appendChild(tag3);

			iniciarEditar() 
			captura(activity, canvas)
			//editar


		})


		// function addCanvas() {
		// 	num_editor_canvas = num_editor_canvas + 1;
		// 	editorCanvasID = "editor-canvas-" + num_editor_canvas.toString();

		// 	if (num_editor_canvas == 2) {
		// 		$("#listaCanvas").append('<div id="' + editorCanvasID + '" class="editor-canvas dropzone" style="background-color:green;border:2px;width:100%; height:100%">');
		// 	} else {

		// 		$("#listaCanvas").append('<div id="' + editorCanvasID + '" class="editor-canvas dropzone" style="background-color:powderblue;border:2px;width:100%; height:100%">');
		// 	}
		// }
		function lanzar() {
			$(canvas).droppable({
				drop: function (event, ui) {
					//this if condition is for avoiding multiple time drop and attachment of same item
					//	console.log("Drop en canvas de nuevo "); 

					limpiarCanvas()
					




					if (ui.draggable.hasClass("tool")) {
						//	console.log("Tiene clase tool");
						var $item = $(ui.helper).clone(); //getting the cloned item

						type = $item.attr('type');
						$item.removeAttr('title');
						$item.removeClass("tool");

						// Area
						var imageUsuarioID = "usuario_" + (num_area + 1)
						var botonUsuarioID = "botonUsuario_" + (num_area + 1)
						var addUser = $('<a id="' + botonUsuarioID + '" class="btn user-image" title="Cambiar a zona de juego" onclick=addUserButton(this)><i id="' + imageUsuarioID + '" class="fa-solid fa-user margenIzquierdo"></i></a>')

						var idUploadArea = "uploadArea_" + (num_area + 1)
						var uploadArea = $('<div class="image-upload" onclick=uploadAreaButton(this,"' + idUploadArea + '") > <label for="' + idUploadArea + '"> <i class="fa-solid fa-upload image-upload"></i> </label> <input id="' + idUploadArea + '" type="file"  accept="image/png, image/gif, image/jpeg"  style="display: none;" /> </div>')

						// Card
						var idTextoTitle = "idTitle_" + (num_card + 1)
						var idButtonCard = "idbuttonCard_" + (num_card + 1)
						var titleTextoCard = $('<div id="' + idTextoTitle + '" class="tituloTexto" onclick=fijarCard(this)><button id="' + idButtonCard + '" class="transparente" onclick="fijarTarjeta(this)"><i class="fa-solid fa-thumbtack  fa-rotate-by" style="--fa-rotate-angle: 320deg;"></i></button><span style="font-weight: bold;">Texto</span></div>')

						var texto3id = "back_" + (num_card + 1)
						var idAcciones = "Acciones_" + (num_card + 1)
						var idFeedback = "Feedback_" + (num_card + 1)
						var idMatematicas = "Matematicas_" + (num_card + 1)
						var tabsCard = $('<section id ="' + texto3id + '" class="ocultar"><div class="tab center"><button class="tablinks active ' + idAcciones+ '" onclick="evaluarTabCard(event, ' + idAcciones + ')">Acciones</button><button class="tablinks ' + idFeedback+ '" onclick="evaluarTabCard(event, ' + idFeedback + ')">Feedback</button><button class="tablinks ' + idMatematicas+ '" style="margin-right:5px;" onclick="evaluarTabCard(event, ' + idMatematicas + ')">Matemáticas</button></div><div id="' + idAcciones + '" style="display:block;" class="tabcontent "><input type="checkbox" checked="true" id="cbox1" value="firest_checkbox"> <label for="cbox1">Seleccionable</label><br><input type="checkbox" checked="true" id="cbox2" value="second_checkbox"> <label for="cbox2">Girable</label><br><input type="checkbox" checked="true" id="cbox3" value="firest_checkbox"> <label for="cbox3">Redimensionable</label></div><div id="' + idFeedback + '" class="tabcontent inputTextRetroalimentacion"><div><div>Retroalimentación</div><textarea  class="inputTextRetroalimentacion" placeholder="Escriba aquí el texto" name = "textoRetroalimentacion" ></textarea></div></div><div id="' +
							idMatematicas + '" class="tabcontent inputNumero"><div><div style="width=100%;">Valor numérico</div><input  type="number" step="any" value="1" /></div></div> </section>')
							
						var textAreaid = "textArea_" + (num_card + 1)
						var inputTexto = $('<textarea id="' + textAreaid + '"class="inputText" placeholder="Escriba aquí el texto" name = "description" ></textarea>')
							
						var configid = "config_card_" + (num_card + 1)
						var configurationButton = $("<div id='" + configid + "' class='config' onclick=mostrarConfigCard(this)><i class='fa-solid fa-gear'></i></div>")
							
						// Image
						var backImageID = "backImage_" + (num_picture + 1)
						var AccionesImageID = "AccionesImage_" + (num_picture + 1)
						var FeedbackImageID = "FeedbackImage_" + (num_picture + 1)
						var MatematicasImageID = "MatematicasImage_" + (num_picture + 1)
						var tabImage = $('<section id ="' + backImageID + '" class="ocultar"><div class="tab center"><button class="tablinks active ' + AccionesImageID +'" onclick="evaluarTabImage(event, ' + AccionesImageID + ')">Acciones</button><button class="tablinks ' + FeedbackImageID +'" onclick="evaluarTabImage(event, ' + FeedbackImageID + ')">Feedback</button><button class="tablinks ' + MatematicasImageID +'" style="margin-right:5px;" onclick="evaluarTabImage(event, ' + MatematicasImageID + ')">Matemáticas</button></div><div id="' + AccionesImageID + '" style="display:block;" class="tabcontent "><input type="checkbox" checked="true" id="cbox1" value="firest_checkbox"> <label for="cbox1">Seleccionable</label><br><input type="checkbox" checked="true" id="cbox2" value="second_checkbox"> <label for="cbox2">Girable</label><br><input type="checkbox" checked="true" id="cbox3" value="firest_checkbox"> <label for="cbox3">Redimensionable</label></div><div id="' + FeedbackImageID + '" class="tabcontent inputTextRetroalimentacion"><div><div>Retroalimentación</div><textarea  class="inputTextRetroalimentacion" placeholder="Escriba aquí el texto" name = "textoRetroalimentacion" ></textarea></div></div><div id="' +
							MatematicasImageID + '" class="tabcontent inputNumero"><div><div style="width=100%;">Valor numérico</div><input  type="number" step="any" value="1" /></div></div> </section>')
								
						var titleImageID = "titleImage_" + (num_picture + 1)
						var idButtonImage = "idbuttonImage_" + (num_picture + 1)
						var titleImage = $('<div id="' + titleImageID + '" class="tituloTexto2" onclick=fijarPicture(this)><button id="' + idButtonImage + '" class="transparente" onclick="fijarTarjeta(this)"><i class="fa-solid fa-thumbtack  fa-rotate-by" style="--fa-rotate-angle: 320deg;"></i></button><span style = "font-weight: bold;">Imagen</span></div>')
							
						var configidImagen = "config_picture_" + (num_picture + 1)
						var configurationButtonImagen = $("<div id='" + configidImagen + "' class='config' onclick=mostrarConfigPicture(this)><i class='fa-solid fa-gear'></i></div>")
							
						var dropzoneID = "dropzone_" + (num_picture + 1)
						dropzoneIDCrear = dropzoneID
						var formDropzoneID = "formDropzone_" + (num_picture + 1) 
						var dropzoneElement = $('<form id="' + formDropzoneID + '" class="form" action="#" method="post"><div class="fv-row"><div class="dropzone" id="' + dropzoneID + '"><div class="dz-message needsclick"><i class="fa-solid fa-cloud-arrow-up fa-2xl"></i><div class="ms-4"><div >Arrastre hasta aquí los archivos o pulse para seleccionar.</div></div></div></div></div></form>')
							
						// Seleccion
						var idSelecciono = "Seleccion_" + num_objetive.toString()
						var seleccionIcono = $('<div id="' + idSelecciono + '" class="SeleccionIcono"><i  class="fa-solid fa-circle-dot fa-2xl"></i></div>')
							
						//Matematicas
						var idMates = "Matematicas_" + num_math.toString()
						var MatesIcono = $('<div class="MatesIcono"><i id="idMates" class="fa-solid fa-calculator fa-2xl"></i><input class="numberMath" type="number" value="1" /></div>')
						
						// Temporizador
						var idTemporizador = "Temporizador_" + num_time.toString()
						var TemporizadorIcono = $('<section  id="' + idTemporizador + '"><div style="margin-bottom:8px;">La actividad finaliza en:</div> <div><i class="TempIcono fa-solid fa-stopwatch fa-2xl"></i><input id="temporizadorMinutos" type="number" value="1" step="any" /> seg.</div></div></section>')

						// Path 
						var idSquarePath = "SquearePath_" + num_path.toString()
						var pathSqueareIcono = $('<div class="squarePath"><div><i id="' + idSquarePath + '" class="squarePath fa-solid fa-square"></i></div></i></div>').click(function () {



						});
						var idPath = "Path_" + (num_path + 1)
						var pathIcono = $('<div class="PathIcono"><i id="' + idPath + '"class="fa-solid fa-location-dot fa-2xl"></i></div>').click(function () { });

						var idConf = "configuration_" + (num_path + 1)
						var idPadrePath = "pathIdPadre_" + (num_path + 1)

						var idHijoPath = "pathIdHijo_" + (num_path + 1)
						var crearCamino = "crearCamino_" + (num_path + 1)
						var pathElemento = $('<section><div><i class="squarePath fa-solid fa-square" onclick="mostrar(' + idConf + ')"></i></div><div><div class="PathIcono"><i class="fa-solid fa-location-dot fa-2xl"></i></div><div id="' + idConf + '" class="configurarPath ocultar"><div style="height:50px"><i class="PathIcono fa-solid fa-location-dot fa-2xl"></i><i class=" fa-solid fa-square"></i><i class="xMark fa-solid fa-xmark" onclick="ocultar(' + idConf + ')"></i></div><div  class="insidePath "><div style="background-color: green;width:40px">Hola</div><div id="' + idPadrePath + '" class="wrap2" style="width:220px"><div id ="' + idHijoPath + '" class="links"></div></div><div style="background-color: green;width:40px; text-align: center;"><i class="fa-solid fa-eye fa-xl"></i></br><input type="color" id="favcolor" name="favcolor" value="#ff0000" ></br><i class="fa-brands fa-connectdevelop fa-xl"></i></div></div><div id="' + crearCamino + '"  class="insidePath"><i class="PathIcono fa-solid fa-location-dot fa-2x"></i>Arrastre hasta aquí para crear un nuevo camino</div></div></div></section>')


						// Para los clones de los caminos
						var idClonCamino = "clonCamino_" + (num_path + 1)

						// Unir
						var idUnir = "Unir_" + num_pairing.toString()
						var unir = $('<canvas id="' + idUnir + '" class="marginCanvas" width="1500px" height="1250px"></canvas>').click(function () { });


						if (type == "area") {
							num_area = num_area + 1
							num_areas_creadas = num_areas_creadas + 1
							numero_areas_activas = numero_areas_activas + 1;
							identifier = 'area' + num_area.toString()
							$item.empty()
							$item.attr("id", 'area' + num_area.toString());
							$item.attr("class", 'area ui-resizable');
							$item.append(addUser)
							$item.append(uploadArea)

							makeAreaDroppable($item)
						} else if (type == "card") {

							num_card = num_card + 1
							identifier = 'card' + num_card.toString()
							$item.empty()
							$item.attr("id", 'card' + num_card.toString());
							$item.attr("class", 'card ui-resizable area-accept')
							$item.append(titleTextoCard)
							$item.append(inputTexto)
							$item.append(tabsCard)
							$item.append(configurationButton)

							makeAreaDroppable($item)
						} else if (type == "picture") {
							num_picture = num_picture + 1
							identifier = 'picture' + num_picture.toString()
							$item.empty()
							$item.attr("id", 'picture' + num_picture.toString());
							$item.attr("class", 'picture ui-resizable area-accept')
							$item.append(titleImage)
							$item.append(dropzoneElement)
							$item.append(tabImage)
							$item.append(configurationButtonImagen)
							makeAreaDroppable($item)
						} else if (type == "objetive") {

							num_objetive = num_objetive + 1
							identifier = 'objetive' + num_objetive.toString()
							$item.empty()
							$item.attr("id", 'objetive' + num_objetive.toString());
							$item.attr("class", 'objetive area-accept')
							$item.append(seleccionIcono)
							lastItem = $item
						} else if (type == "pairing") {
							num_pairing = num_pairing + 1
							identifier = 'pairing' + num_pairing.toString()
							$item.empty()
							$item.attr("id", 'pairing' + num_pairing.toString());
							$item.attr("class", 'pairing ui-resizable area-accept')
							$item.append(unir)



						} else if (type == "path") {
							num_path = num_path + 1
							identifier = 'path' + num_path.toString()
							$item.empty()
							$item.attr("id", 'path' + num_path.toString());
							$item.attr("class", 'path ui-resizable area-accept originalPath' + " " + canvas)
							//	$item.append(pathSqueareIcono)
							$item.append(pathElemento)
							lastPath = $item

							// Comprobar si no hay camino
							if (listPath.length === 0) {
								var randomColor = Math.floor(Math.random() * 16777215).toString(16);
								var camino = new Camino("camino1", idClonCamino, randomColor)
								listPath.push(camino)
								lastCamino = "camino1"
							} else {
								const resultado = listPath.find(Camino => Camino.caminoID === lastCamino);
								resultado.elementos += idClonCamino + ";"
							}


							// if(num_path <= 5){
							// 	document.getElementById("pathid").append(newDiv)
							// }else{
							// 	document.getElementById("pathid2").append(newDiv)
							// }
							// var rect = newDiv.getBoundingClientRect();
							// console.log("Path position:",rect.top, rect.right, rect.bottom, rect.left);
							// var medioX = rect.top + 30
							// console.log("mdioX", medioX)
							// var medioY = rect.right + 30
							// console.log("mdioY", medioY)
							// if (num_path == 2){
							// 	unir()
							// }

							//makeAreaDroppable(document.getElementById("arrastrar"))
						} else if (type == "math") {
							num_math = num_math + 1
							identifier = 'math' + num_math.toString()
							$item.empty()
							$item.attr("id", 'math' + num_math.toString());
							$item.attr("class", 'math  area-accept')
							$item.append(MatesIcono)
						} else if (type == "time") {
							num_time = num_time + 1
							identifier = 'time' + num_time.toString()
							$item.empty()
							$item.attr("id", 'time' + num_time.toString());
							$item.attr("class", 'time ui-resizable ')
							$item.append(TemporizadorIcono)
							itemTemporizador = $item

						}
						$(this).append($item);
						makeDraggable($item);
						lastItem = $item
						//var a = document.getElementById("area1").getBoundingClientRect();
						//	console.log("a", a.left, a.top, a.bottom, a.right)
						if (type == "objetive" || type == "math" || type == "time" || type == "path") {
							var content = document.getElementById($item[0].id)
							if(content.lastElementChild != null){
								content.lastElementChild.remove()
							}
								
							if(content.lastElementChild != null){
								content.lastElementChild.remove()
							}
							if(content.lastElementChild != null){
								content.lastElementChild.remove()
							}
						}

						if (type == "card" || type == "picture") {
							//	console.log("ENTRO A RECOLOCAR")
							if (pointerElementID != "" && pointerElementID.includes("area")) {

								//	console.log("el hijoopadre del item es area ", $item[0].id)
								var hijo = document.getElementById($item[0].id)
									//	var rect = hijo.getBoundingClientRect();
									//	console.log("Las posiciones hijo son",rect.top, rect.right, rect.bottom, rect.left);
									;// =" position: absolute; left: 60px; top: 35px;"
								parent = document.getElementById(pointerElementID)
								var rect = parent.getBoundingClientRect();
								//	console.log("Las posiciones padre son", rect.top, rect.right, rect.bottom, rect.left);
								var je = posRight - rect.top
								var jo = posLeft - rect.left
								//	console.log("resta top", je, "resta left", jo)
								hijo.style = "top:" + je + "px; left:" + jo + "px;"
								parent.appendChild(document.getElementById($item[0].id))

							}
						}

						if (type == "path") {

							var idCamino = "camino_" + numCaminos
							//	console.log("el path es", $item[0])
							var clon = document.createElement("div")
							clon.innerHTML = '<i class="fa-solid fa-location-dot fa-2xl"></i>'
							clon.style = "left: 0px; top: 0px; position: relative"
							clon.id = idClonCamino
							clon.classList.remove("originalPath")
							clon.classList.add(idCamino)
							clon.classList.add("dot")

							//	var newDiv = document.createElement("div");
							//	newDiv.id = "pruebamover_" + num_path.toString()
							clon.classList.add("inline")
							//	newDiv.classList.add("links")
							//	newDiv.style = "width: 30px; height: 30px"
							//	newDiv.appendChild(clon)
							var elementoCaminoNuevo = new ElementoCamino(idClonCamino, clon, canvas)
							listElementoCaminosClonados.push(elementoCaminoNuevo)

							getElementPath()
							$(clon).draggable();


							$("#" + crearCamino).droppable({
								drop: function (event, ui) {
									$(this).css('background', 'rgb(0,200,0)');
									console.log("Elemento", ui.draggable[0].id)
									/*
									var newDiv = document.createElement("div");
									newDiv.id = "pathid" + num_pathid.toString()
									num_pathid++
									newDiv.append(document.getElementById(ui.draggable[0].id))

									document.getElementById("pathidPadre").append(newDiv)
									*/
								},
								over: function (event, ui) {
									$(this).css('background', 'orange');
								},
								out: function (event, ui) {
									$(this).css('background', 'cyan');
								}
							});
							//	document.getElementById(idHijoPath).append(clon)

						}

						if (type == "pairing") {
							onmousemove = function (e) {
								document.onmousemove = function (event) {
									var item = document.getElementById("pairing1")
									item.style.width = -1 * event.clientX + 'px';
									item.style.height = -1 * event.clientY + 'px';


								}

								const target = e.target;

								// Get the bounding rectangle of target
								const rect = target.getBoundingClientRect();

								// Mouse position
								posLeft = e.clientX - rect.left;;
								posRight = e.clientY - rect.top;
								dibujar(800, 0, posLeft, posRight, idUnir)



							}

						}
					} else {
						/** Una tarjeta, área o objetivo se está soltando **/
						//	console.log("recolocooooo 1")
						var $item = $(ui.draggable[0])
						if ($item.parent().attr("id") != $(this).attr("id")) {
							$item.css("left", parseFloat($item.css("left"), 10) + parseFloat($item.parent().css(
								"left"), 10))
							$item.css("top", parseFloat($item.css("top"), 10) + parseFloat($item.parent().css("top"),
								10))
						}
						$(this).append($item)
					}
					//	console.log("numero areas activas", numero_areas_activas)
					

				}
			})
		}
		lanzar()

		// PRUEBA CANVAS2





		// FIN PRUEBA CANVAS 2
		function makeAreaDroppable($item) {
			$item.droppable({
				accept: ".area-accept",
				greedy: true,
				drop: function (event, ui) {
					//this if condition is for avoiding multiple time drop and attachment of same item
					console.log("Drop en zona")
					if (ui.draggable.hasClass("tool")) {
						console.log("Se dropea en zona");
						var $item = $(ui.helper).clone(); //getting the cloned item
						type = $item.attr('type');
						$item.removeClass("tool");
						if (type == "area") {
							num_area = num_area + 1
							identifier = 'area' + num_area.toString()
							$item.empty()
							$item.attr("id", 'area' + num_area.toString());
							$item.attr("class", 'area ui-resizable');
						} else if (type == "card") {
							num_card = num_card + 1
							identifier = 'card' + num_area.toString()
							$item.empty()
							$item.attr("id", 'card' + num_area.toString());
							$item.attr("class", 'card ui-resizable area-accept')
							$item.css("left", parseFloat($item.css("left"), 10) - parseFloat($(this).css("left"),
								10))
							$item.css("top", parseFloat($item.css("top"), 10) - parseFloat($(this).css("top"), 10))
						} else if (type == "picture") {
							num_picture = num_picture + 1
							identifier = 'picture' + num_area.toString()
							$item.empty()
							$item.attr("id", 'picture' + num_area.toString());
							$item.attr("class", 'picture ui-resizable area-accept')
							$item.css("left", parseFloat($item.css("left"), 10) - parseFloat($(this).css("left"),
								10))
							$item.css("top", parseFloat($item.css("top"), 10) - parseFloat($(this).css("top"), 10))
						} else if (type == "objetive") {
							num_objetive = num_objetive + 1
							identifier = 'objetive' + num_area.toString()
							$item.empty()
							$item.attr("id", 'objetive' + num_area.toString());
							$item.attr("class", 'objetive  area-accept')
							$item.css("left", parseFloat($item.css("left"), 10) - parseFloat($(this).css("left"),
								10))
							$item.css("top", parseFloat($item.css("top"), 10) - parseFloat($(this).css("top"), 10))
						} else if (type == "pairing") {
							num_pairing = num_pairing + 1
							identifier = 'pairing' + num_area.toString()
							$item.empty()
							$item.attr("id", 'pairing' + num_area.toString());
							$item.attr("class", 'pairing ui-resizable area-accept')
							$item.css("left", parseFloat($item.css("left"), 10) - parseFloat($(this).css("left"),
								10))
							$item.css("top", parseFloat($item.css("top"), 10) - parseFloat($(this).css("top"), 10))
						} else if (type == "path") {
							num_path = num_path + 1
							identifier = 'path' + num_area.toString()
							$item.empty()
							$item.attr("id", 'path' + num_area.toString());
							$item.attr("class", 'path ui-resizable area-accept')
							$item.css("left", parseFloat($item.css("left"), 10) - parseFloat($(this).css("left"),
								10))
							$item.css("top", parseFloat($item.css("top"), 10) - parseFloat($(this).css("top"), 10))
						} else if (type == "math") {
							num_math = num_math + 1
							identifier = 'math' + num_area.toString()
							$item.empty()
							$item.attr("id", 'math' + num_area.toString());
							$item.attr("class", 'math ui-resizable area-accept')
							$item.css("left", parseFloat($item.css("left"), 10) - parseFloat($(this).css("left"),
								10))
							$item.css("top", parseFloat($item.css("top"), 10) - parseFloat($(this).css("top"), 10))
						}
						//	console.log("por el 2")
						$(this).append($item);
						makeDraggable($item);
					} else {
						/** Una tarjeta, área o objetivo se está soltando **/
						//	console.log("recolocooooo 2")
						var $item = $(ui.draggable[0])
						if ($item.parent().attr("id") != $(this).attr("id")) {
							console.log("Cambia de padre");
							$item.css("left", parseFloat($item.css("left"), 10) - parseFloat($(this).css("left"),
								10))
							$item.css("top", parseFloat($item.css("top"), 10) - parseFloat($(this).css("top"), 10))
						}
						//	console.log("el padres this es", $(this))
						//	console.log("el padre item es", $item)
						$(this).append($item)
					}
				}
			})
		}
		onmousemove = function (e) {

			const target = e.target;

			// Get the bounding rectangle of target
			const rect = target.getBoundingClientRect();

			// Mouse position
			posLeft = e.clientX //  - rect.left;;
			posRight = e.clientY - 48 // - rect.top; 
			//	dibujar(mouseX,mouseY,posLeft,posRight, "canvas2")

			// var canv = document.getElementById("canvas2")
			// var ctx = document.getElementById("canvas2").getContext("2d")
			// ctx.clearRect(0, 0, canv.width, canv.height);

			// ctx.beginPath();
			// ctx.moveTo(mouseX,mouseY)
			// ctx.lineTo(posLeft, posRight)
			// ctx.strokeStyle = "black"
			// ctx.lineWidth = 10;
			// ctx.stroke()
			// 	console.log("mouse location:", "left", posLeft, "top", posRight)
			//


		}



		function makeDraggable($item) {
			$item.draggable({
				containment: "#editzone",
				helper: "original",
				appendTo: "body",
				start: function () { },
				stop: function () {
					console.log('stopped 1')



					evaluarPosicion($item) 
					actualizarTarjetas("card")
					actualizarTarjetas("picture") 
					evaluarMostrarMenu() 
					limpiarCanvas()
					//	ocultarOpciones()


				}
			}).resizable({
				start: function (e, ui) {
					console.log('resizing started');
				},
				resize: function (e, ui) {

				},
				stop: function (e, ui) {
					console.log('resizing stopped');
					captura(activity, canvas)
					console.log("El act de captura", activity)
					console.log("el canvas de captura", canvas)
				}
			});
		}

		function printMousePos(event) {
			console.log("mouse", "top:", event.clientY, "left:", event.clientX)

			mouseX = event.clientX
			mouseY = event.clientY
		}

		document.addEventListener("click", printMousePos);




		$(".tool").draggable({
			containment: "#editzone",
			helper: "clone",
			start: function () { },
			stop: function () {
				console.log('stopped 2')

				var isDropzone = document.getElementById(dropzoneIDCrear)
				//	console.log("is dropzone", dropzoneIDCrear)
				dropzoneUpload(dropzoneIDCrear)

				if (itemTemporizador != null) {
					//	console.log('Temporizador', itemTemporizador[0].id)
					var temporizador = document.getElementById(itemTemporizador[0].id)
					temporizador.style.position = "fixed"
					temporizador.style.left = "87%"
					temporizador.style.top = "85%"
				}

				evaluarPosicionInicio(lastItem)
				//		evaluarPosicion(lastItem)

				//	captura();
				captura(activity, canvas);

				actualizarTarjetas("card")
				actualizarTarjetas("picture") 
				evaluarMostrarMenu() 
				limpiarCanvas()
				// var canvas = document.getElementById("editor-canvas")

				// var clone = canvas.cloneNode(true)

				// console.log("El canvas es", canvas)
				// console.log("El clon es", clone)


				// var prueba = 	document.getElementById("prueba")
				// prueba.innerHTML = '';
				// console.log("La ´hijos prueba es", prueba)

				// console.log("La prueba es", prueba)

				// var nodes = clone.childNodes;
				// for(var i=0; i<nodes.length; i++) {

				// 		 nodes[i].style.width = "10%";
				// 		 nodes[i].style.height = "auto";

				// }
				// prueba.append(clone)
				//	$("#prueba").load("/editor/editor #area1");

				// if (lastItem != null ) {
				// 	console.log("el id es", lastItem[0].id)
				// 	console.log("el padre del item es", lastItem.parent()[0].id)
				// }

			}
		});

		

		



		/*
				$(document).on("input", "input:file", function (e) {
					let fileName = e.target.files[0];
					console.log("EL UPLOAD AREA ES", uploadAreaID)
					console.log("el evento es", e)
					if (uploadAreaID != "") {
						if (fileName != undefined) {
							src1 = URL.createObjectURL(e.target.files[0]);
							document.getElementById(uploadAreaID).style.backgroundImage = 'url(' + src1 + ')';
						} else {
							document.getElementById(uploadAreaID).style.backgroundImage = 'none';
						}
					}
					
					//     alert('The file name is : "' + fileName);
				});
				*/



		// function changeBackground(input) {
		// 	//	console.log("el id del input es", input.id)
		// 	var idinput = input.id.split("_")
		// 	id = parseInt(idinput[1]) + 1
		// 	areaID = "area" + id.toString()
		// 	if (isarea) {
		// 		var file = $("input[type=file]").get(0).files[0];
		// 	}
		// }
		

		



		

		// function captura() {
		// 	html2canvas(document.querySelector("#editzone")).then(canvas => {
		// 		var prueba = document.getElementById("pruebita")
		// 		prueba.innerHTML = ''; 
		// 		canvas.style.width = "80%"
		// 		canvas.style.height = "auto"
		// 		console.log("la captura es", canvas)
		// 		prueba.appendChild(canvas)
		// 	});
		// }

		function captura(name, canvas) {
			var el = document.querySelector(canvas)
			html2canvas(el, {
				scale: 0.9,
				useCORS: true,
				// foreignObjectRendering:true,
				//    windowWidth: el.scrollWidth,
				//   windowHeight: el.scrollHeight,
				onclone: () => {
					//lert();
				}
			}).then((canvas) => {

				var prueba = document.getElementById(name)
				prueba.innerHTML = '<div class="deleteActivity" onclick="eliminarActividad($(this))" >x</div>';
				canvas.style.width = "100%"
				canvas.style.height = "auto"
			//	console.log("la captura es", canvas)
				prueba.appendChild(canvas) 
			});
		}

		// $("#pruebamover_1").draggable();
		// $("#jeje_1").draggable();


		$("#arrastrar").droppable({
			drop: function (event, ui) {
				$(this).css('background', 'rgb(0,200,0)');
				console.log("Elemento", ui.draggable[0].id)

				var newDiv = document.createElement("div");
				newDiv.id = "pathid" + num_pathid.toString()
				num_pathid++
				newDiv.append(document.getElementById(ui.draggable[0].id))

				document.getElementById("pathidPadre").append(newDiv)
			},
			over: function (event, ui) {
				$(this).css('background', 'orange');
			},
			out: function (event, ui) {
				$(this).css('background', 'cyan');
			}
		});


		function ocultar(elemento) {
			//	console.log("El id para borrar", elemento)
			document.getElementById(elemento.id).classList.add("ocultar")
			captura(activity, canvas)
		}

		function mostrar(elemento) {
			//	console.log("El id para mostrar", elemento[0].id)

			document.getElementById(elemento.id).classList.remove("ocultar")
			captura(activity, canvas)
		}



		//Canvas

		function dibujar(x1, y1, x2, y2, id) {
			var canvas = document.getElementById(id);
			var context = canvas.getContext("2d");

			//console.log("elementos en una posicion dada", document.elementFromPoint(x1, y1))
			function Line(x1, y1, x2, y2) {
				this.x1 = x1;
				this.y1 = y1;
				this.x2 = x2;
				this.y2 = y2;
			}
			Line.prototype.drawWithArrowheads = function (ctx) {

				// arbitrary styling
				ctx.strokeStyle = "gray";
				ctx.fillStyle = "red";
				ctx.lineWidth = 5;

				// draw the line
				ctx.clearRect(0, 0, canvas.width, canvas.height);


				ctx.beginPath();
				ctx.moveTo(this.x1, this.y1);
				ctx.lineTo(this.x2, this.y2);

				ctx.lineCap = "round";
				ctx.stroke();

				// draw the starting arrowhead

				// draw the ending arrowhead
				var endRadians = Math.atan((this.y2 - this.y1) / (this.x2 - this.x1));
				endRadians += ((this.x2 > this.x1) ? 90 : -90) * Math.PI / 180;
				this.drawArrowhead(ctx, this.x2, this.y2, endRadians);

			}
			Line.prototype.drawArrowhead = function (ctx, x, y, radians) {
				ctx.save();
				ctx.beginPath();
				ctx.translate(x, y);
				ctx.rotate(radians);
				ctx.moveTo(0, 0);
				ctx.lineTo(50, 100);
				ctx.lineTo(-50, 100);
				ctx.closePath();
				ctx.restore();
				ctx.fill();
			}

			// create a new line object
			var line = new Line(x1, y1, x2, y2);
			// draw the line
			line.drawWithArrowheads(context);
		}
		
		document.addEventListener('mousemove', e => {
			isPicture = false
			isCard = false
			padrePicture = null
			padreCard = null
			// console.clear()
			var elems = document.elementsFromPoint(e.clientX, e.clientY)
			//console.log("elementos",elems)
			for (let i = 0; i < elems.length; i++) {

				if (elems[i].id.includes("dropzone_") || elems[i].id.includes("picture") || elems[i].id.includes("titleImage_")) {
					isPicture = true
					if (elems[i].id.includes("picture")) {
						padrePicture = elems[i].id
					}
					isCard = false
					padreCard = null
				}
				
				if (elems[i].id.includes("idTitle_") || elems[i].id.includes("card")) {
					isCard = true
					if (elems[i].id.includes("card")) {
						padreCard = elems[i].id
					}
					isPicture = false
					padrePicture = null
				}
			}

			if (elems != null) (
				pointerElementID = elems[0].id
			)
			// console.log("ELEMENTO EN POSICION",el)
		}, { passive: true })

		

		
		


		

		
		




		

	</script>
	{% endblock %}